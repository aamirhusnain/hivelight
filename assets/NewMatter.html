<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    <title>Document</title>
    <style>
        .loader {
            display: none;
            vertical-align: middle;
            position: absolute;
            left: 50%;
            top: 42%;
            width: 30px;
            padding: 3px;
            aspect-ratio: 1;
            border-radius: 50%;
            background: #000000;
            --_m:
                conic-gradient(#19191900 10%, #343434),
                linear-gradient(#4d4d4d 0 0) content-box;
            -webkit-mask: var(--_m);
            mask: var(--_m);
            -webkit-mask-composite: source-out;
            mask-composite: subtract;
            animation: l3 1s infinite linear;
        }

        @keyframes l3 {
            to {
                transform: rotate(1turn)
            }
        }

        .loader-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(244, 244, 244, 0.5);
            z-index: 9;
        }

        .options-dropdown {
            position: absolute;
            display: none;
            z-index: 10;
            background-color: #fff;
            border: 1px solid #ddd;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            max-height: 150px;
            overflow-y: auto;
        }

        .options-dropdownedit {
            display: none;
            position: absolute;
            top: 56px;
            left: 31px;
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 8px;
            z-index: 1;
        }

        .options-dropdown button {
            display: block;
            width: 100%;
            text-align: left;
            padding: 8px;
            border: none;
            background-color: transparent;
            cursor: pointer;
        }

        #matterNameid {
            width: "37%"
        }
    </style>
</head>

<body>
    <div class="loader z-10" id="loader"></div>
    <div class="loader-overlay" id="loaderOverlay"></div>

    <div class="p-2 z-20">
        <div class="w-full z-20 fixed bg-white top-0 border-b-2 border-gray-200 py-4">
            <span id="createMatter" style="font-size: 22px;font-weight: 400;"
                class="h-4 text-gray-700 text-sm font-bold "></span>
        </div>

        <form class="space-y-2 z-10 mt-14" action="#" method="POST">
            <label id="matterName" class="text-gray-700 font-bold"></label>
            <div class="">
                <input type="text" id="matterNameid" placeholder="Enter name of the matter.."
                    class="w-1/3 px-2 py-2 bg-white text-sm border-2 border-gray-200 focus:border-blue-600 rounded outline-none" />
            </div>

            <div class="relative">
                <label id="initialMatterNote" class="text-gray-700 text-sm font-bold mb-2"></label>
                <div class="relative" style="margin-top: -2%;">
                    <i id="addIconEditdiv" onclick="showOptionsDropdown()" class="fa fa-plus relative"
                        aria-hidden="true" style="display: inline; top: 56px; left: 30px;"></i>
                    <div id="initialMatterNote"
                        class="h-[7rem] px-2 py-2 bg-white text-sm border-2 border-gray-200 focus:border-blue-600 rounded outline-none p-2 0 overflow-hidden overflow-y-auto"
                        contenteditable id='editor' onfocus="ShowaddIconEditdiv()" style="padding:40px; width: 87%;">
                        <div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="">
                    <div>
                        <label id="matterOwner" class="text-gray-700 font-bold mb-2"></label><br>
                        <p id="matterOwnerDes" class="text-sm text-gray-500 font-normal"></p>
                        <div class="">
                            <input id="userInput" type="text" placeholder="Search for user" onfocus="SearchForOwners()"
                                class="w-3/4 px-2 py-2 my-2 bg-white text-sm border-2 border-gray-200 focus:border-blue-600 rounded outline-none relative" />

                            <div id="usersdropdown"
                                style="overflow: scroll; overflow-x: unset; height: 28%; width: 36%;"
                                class="absolute mt-2 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 hidden">

                                <ul id="optionsList" class="py-1">
                                    <!-- Options will be dynamically added here -->
                                </ul>
                            </div>

                            <div id="selectedMatterUser" class="mt-2">
                                <!-- Selected matter types will be dynamically added here -->
                            </div>
                        </div>
                    </div>

                    <div>
                        <label id="matterLead" class="text-gray-700 font-bold mb-2"></label><br>
                        <p id="matterLeadDes" class="text-sm text-gray-500 font-normal"></p>
                        <div class="">
                            <input id="matterLeadInput" type="text" placeholder="Search for users"
                                onfocus="showMatterLeadusuers()"
                                class="w-3/4 px-2 py-2 bg-white mt-2 text-sm border-2 border-gray-200 focus:border-blue-600 rounded outline-none" />

                            <div id="matterleadDropdown"
                                style="overflow: scroll; overflow-x: unset; height: 28%; width: 36%;"
                                class="absolute mt-2 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 hidden">

                                <ul id="matterleadList" class="py-1">
                                    <!-- Options will be dynamically added here -->
                                </ul>
                            </div>

                            <div id="SelectedMatterLeaduser" class="mt-2">
                                <!-- Selected items will be dynamically added here -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class=" p-2">
                    <div>
                        <label id="matterPraticeTypes" class="text-gray-700 text-sm font-bold "></label>
                        <div class="">
                            <input id="matterType" type="text" placeholder="Start typing a matter type"
                                onfocus="showMatterTypeDropdown()"
                                class="w-3/4 px-2 py-2 bg-white mt-2 text-sm border-2 border-gray-200 focus:border-blue-600 rounded outline-none" />

                            <div id="matterTypeDropdown"
                                style="overflow: scroll; overflow-x: unset; height: 24%; width: 35%;"
                                class="absolute mt-2 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 hidden">

                                <ul id="matterTypeOptionsList" class="py-1">
                                    <!-- Options will be dynamically added here -->
                                </ul>
                            </div>

                            <div id="selectedMatterTypes" class="mt-2">
                                <!-- Selected matter types will be dynamically added here -->
                            </div>
                        </div>
                    </div>

                    <div>
                        <label id="matterJurisdiction" class="text-gray-700 text-sm font-bold "></label><br>
                        <div class="">
                            <input id="Jurisdiction" type="text" placeholder="Start typing Jurisdiction name"
                                onfocus="showDropdown()" oninput="Jurisdiction()"
                                class="w-3/4 px-2 py-2 mt-2 bg-white text-sm border-2 border-gray-200 focus:border-blue-600 rounded outline-none" />
                            <div id="Jurisdictiondropdown"
                                style="overflow: scroll; overflow-x: unset; height: 24%; width: 35%;"
                                class="absolute mt-2 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 hidden">

                                <ul id="JurisdictionoptionsList" class="py-1">
                                    <!-- Options will be dynamically added here -->
                                </ul>
                            </div>

                            <div id="selectedItems" class="mt-2">
                                <!-- Selected items will be dynamically added here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>

        <div id="actionbtns" style="position: sticky; width: 22%; right: 0; left: 78%; top: 16px; padding: 2px"
            class="fixed bg-white bottom-0 left-0 right-0 mb-4 flex justify-end">

            <button class="bg-white hover:bg-gray-100 border-2 text-black py-2 px-4 mr-5 rounded"
                onclick="closeDialog()">Cancel</button>

            <button id="SaveNewMatter" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 mr-2 rounded"
                onclick="SaveNewMatter()">Save</button>
        </div>
    </div>

    <script>
        function startLoader() {
            var loader = document.getElementById('loader');
            loader.style.display = 'block';

            var loaderOverlay = document.getElementById('loaderOverlay');
            loaderOverlay.style.display = 'block';
        }

        function endLoader() {
            var loader = document.getElementById('loader');
            loader.style.display = 'none';

            var loaderOverlay = document.getElementById('loaderOverlay');
            loaderOverlay.style.display = 'none';
        }

        Office.onReady(function () {
            startLoader();
            Office.context.ui.addHandlerAsync(Office.EventType.DialogParentMessageReceived,
                onMessageFromParent);
        });

        let createMatterObj = {
            createMatter: "Create Matter",
            matterName: "Matter Name",
            initialMatterNote: "Initial matter note",
            matterOwner: "Matter owner (mandatory)",
            matterOwnerDes:
                "This role is for the principal or partner level lawyer who owns the matters and is ultimately responsible for them.",
            matterLead: "Matter lead",
            matterLeadDes:
                "This role is for the more senior employed lawyer (typically they will have a title like 'senior associate') who is responsible for the day to day management of the Matter Owner.",
            matterPraticeTypes: "Practice Areas/Types",
            matterJurisdiction: "Jurisdiction",
        };
        // console.log(createMatterObj);

        const createMatter = document.getElementById("createMatter");
        createMatter.textContent = createMatterObj.createMatter;

        const matterName = document.getElementById("matterName");
        matterName.textContent = createMatterObj.matterName;

        const initialMatterNote = document.getElementById("initialMatterNote");
        initialMatterNote.textContent = createMatterObj.initialMatterNote;

        const matterOwner = document.getElementById("matterOwner");
        matterOwner.textContent = createMatterObj.matterOwner;

        const matterOwnerDes = document.getElementById("matterOwnerDes");
        matterOwnerDes.textContent = createMatterObj.matterOwnerDes;

        const matterLead = document.getElementById("matterLead");
        matterLead.textContent = createMatterObj.matterLead;

        const matterLeadDes = document.getElementById("matterLeadDes");
        matterLeadDes.textContent = createMatterObj.matterLeadDes;

        const matterPraticeTypes = document.getElementById("matterPraticeTypes");
        matterPraticeTypes.textContent = createMatterObj.matterPraticeTypes;

        const matterJurisdiction = document.getElementById("matterJurisdiction");
        matterJurisdiction.textContent = createMatterObj.matterJurisdiction;

        let baseUrl = "https://app-staging.hivelight.com/";

        let BearerToken;
        let storedToken;
        let userId;
        let currentUserId;
        let currentMatterId;
        let newMatterId;
        let workspaceId;
        let matterWorkspaceId;
        let selectedOwnerUserId;
        let matterOwnerUserStatus;
        let selectedLeadUserId;
        let matterLeadUserStatus;
        let fullNames = [];
        let userStatus = [];
        let combinedData = [];
        let matterUsercombinedData;
        let userData = [];
        let authenicateToken;
        let createMatterData;
        var matterTypeArray = [];
        var jurisdictionArray = [];
        var owner = [];
        var lead = [];
        let workspaceAuthenicateToken;
        function onMessageFromParent(arg) {
            const messageFromParent = JSON.parse(arg.message);
            // console.log(messageFromParent);

            userId = messageFromParent.userId;
            localStorage.setItem("userId", userId);
            console.log(userId);

            BearerToken = messageFromParent.BearerToken;
            localStorage.setItem("BearerToken", BearerToken);
            console.log(BearerToken);

            currentMatterId = messageFromParent.currentMatterId;
            localStorage.setItem("currentMatterId", currentMatterId);
            console.log(currentMatterId);

            matterWorkspaceId = messageFromParent.matterWorkspaceId;
            localStorage.setItem("matterWorkspaceId", matterWorkspaceId);
            console.log(matterWorkspaceId);
        }

        currentUserId = localStorage.getItem("userId");
        console.log(currentUserId);

        storedToken = localStorage.getItem("BearerToken");
        console.log(storedToken);

        newMatterId = window.localStorage.getItem("currentMatterId");
        console.log(newMatterId);

        workspaceId = window.localStorage.getItem("matterWorkspaceId");
        console.log(workspaceId);

        // Authenticate Workspace Call
        if (workspaceId) {
            const requestData = {
                meta: {
                    token: storedToken,
                    workspaceId: workspaceId,
                },
            };

            fetch(baseUrl + "v1/identities/authenticate/workspace", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(requestData),
            })
                .then((response) => {
                    if (!response.ok) {
                        throw new Error("Network response was not ok");
                    }
                    return response.json();
                })
                .then((data) => {
                    console.log(data);
                    authenicateToken = data.meta.token;
                    console.log(authenicateToken);
                    localStorage.setItem("workspaceAuthenicateToken", authenicateToken);
                    endLoader();
                })
                .catch((error) => {
                    console.error("There was a problem with the fetch operation:", error);
                    endLoader();
                });
        }

        workspaceAuthenicateToken = localStorage.getItem("workspaceAuthenicateToken");
        console.log(workspaceAuthenicateToken);

        if (workspaceAuthenicateToken) {
            var myHeaders = new Headers();
            myHeaders.append("Authorization", "Bearer " + workspaceAuthenicateToken);

            var requestOptions = {
                method: 'GET',
                headers: myHeaders,
                redirect: 'follow'
            };

            fetch(baseUrl + "v1/users?matter=\"" + newMatterId + "\"&workspace=\"" + workspaceId + "\"", requestOptions)
                .then(response => response.json())
                .then(result => {
                    console.log(result);
                    let data = result.data;
                    // console.log(data);

                    const userData = {
                        userId: data.map(user => user.id),
                        userFullName: data.map(user => `${user.attributes.firstName} ${user.attributes.lastName}`),
                        userStatus: data.map(user => user.attributes.status)
                    }
                    // console.log(userData);
                    // combinedData = userData.userId.map((userId, index) => ({
                    //     userId: userId,
                    //     userFullName: userData.fullName[index],
                    //     userStatus: userData.userStatus[index]
                    // }));
                    // console.log(combinedData);

                    combinedData = userData.userFullName.map((fullName, index) => ({
                        userId: userData.userId[index],
                        userFullName: fullName,
                        userStatus: userData.userStatus[index]
                    }));
                    // console.log(combinedData);
                    // localStorage.setItem("matterUsercombinedData", JSON.stringify(combinedData));

                    fullNames = combinedData.map(user => user.userFullName);
                    console.log('Full Names:', fullNames);

                    userStatus = combinedData.map(user => user.userStatus);
                    console.log('User Status:', userStatus);
                    endLoader();
                })
                .catch(error => {
                    console.log('error', error);
                    endLoader();
                });
        }

        function SaveNewMatter() {
            startLoader();
            const myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");
            myHeaders.append("Authorization", "Bearer " + workspaceAuthenicateToken);

            let matterName = document.getElementById("matterNameid").value;
            let matterDiscription = document.getElementById("initialMatterNote").innerText;

            let UserId = window.localStorage.getItem("userid");
            console.log(UserId);

            const requestData = JSON.stringify({
                "jsonapi": {
                    "version": "1.0"
                },
                "data": {
                    "type": "matter",
                    "attributes": {
                        "name": matterName,
                        "jurisdictions": jurisdictionArray,
                        "types": [
                            "1234abcd"
                        ],
                        "description": matterDiscription,
                        "roles": {
                            "OWNER": [
                                selectedOwnerUserId
                            ],
                            "LEAD": [
                                selectedLeadUserId
                            ]
                        }
                    }
                }
            });

            const requestOptions = {
                method: "POST",
                headers: myHeaders,
                body: requestData,
                redirect: "follow"
            };

            fetch(baseUrl + "v1/matters/" + currentUserId, requestOptions)
                .then(response => response.text())
                .then(result => {
                    // console.log(result);
                    let data = JSON.parse(result);
                    console.log(data);

                    Office.context.ui.messageParent(JSON.stringify(data));
                    endLoader();
                })
                .catch(error => console.log('error', error));
            endLoader();
        }

        // Close Dialog Function
        let cancelDialog = "Cancel Dialog";
        function closeDialog() {
            console.log("Cancel Button CLicked");
            Office.context.ui.messageParent(JSON.stringify(cancelDialog));
        }

        // const getCombinedData = localStorage.getItem("matterUsercombinedData");
        // matterUsercombinedData = JSON.parse(getCombinedData);
        // console.log(matterUsercombinedData);

        // fullNames = matterUsercombinedData.map(user => user.userFullName);
        // console.log('Full Names:', fullNames);

        // get tokken form url 
        const urlParams = new URLSearchParams(window.location.search);
        var token = urlParams.get('token');

        userNameData = ["Wallace Veum", "Jeanette McLaughlin", "Harold Mante", "Noah Bahringer", "Lori Tromp"];
        userStatusData = ["ACTIVE"];
        function populateDropdown(filteredOptions) {
            const optionsList = document.getElementById('optionsList');
            optionsList.innerHTML = '';

            filteredOptions.forEach((option, index) => {
                // console.log(option);
                const li = document.createElement('li');
                li.style.cursor = 'pointer';
                li.style.transition = 'background-color 0.3s';
                li.classList.add('flex', 'items-center', 'text-gray-700', 'hover:bg-gray-100', 'px-4', 'py-2', 'cursor-pointer');

                li.style.padding = '8px';
                li.style.borderBottom = '1px solid #ccc';

                li.addEventListener('mouseenter', () => {
                    li.style.backgroundColor = '#F3FDFF';
                    li.style.color = '#000000';
                });

                li.addEventListener('mouseleave', () => {
                    li.style.backgroundColor = 'transparent';
                    li.style.color = 'black';
                });

                const user = document.createElement('div');

                function getRandomColor() {
                    const letters = '0123456789ABCDEF';
                    let color = '#';
                    for (let i = 0; i < 6; i++) {
                        color += letters[Math.floor(Math.random() * 6)];
                    }
                    return color;
                }

                user.classList.add('w-8', 'h-8', 'rounded-full', 'text-white', 'flex', 'items-center', 'justify-center', 'mr-2');
                user.style.backgroundColor = getRandomColor();
                const initials = option.split(' ', 2).map(word => word.charAt(0)).join('').toUpperCase();
                user.textContent = initials;

                li.appendChild(user);

                const userInfoContainer = document.createElement('div');
                userInfoContainer.classList.add('flex', 'flex-col', 'mx-2');

                const userName = document.createElement('span');
                userName.textContent = option;
                userName.classList.add('pt-2', 'text-base', 'font-semibold');

                const userRole = document.createElement('span');
                // userRole.textContent = combinedData[index].userStatus;
                userRole.textContent = userStatusData;

                userInfoContainer.appendChild(userName);
                userInfoContainer.appendChild(userRole);

                li.appendChild(userInfoContainer);

                li.onclick = () => selectOption(option);
                optionsList.appendChild(li);
            });
        }

        function SearchForOwners() {
            const searchInput = document.getElementById('userInput');
            const usersdropdown = document.getElementById('usersdropdown');
            const searchTerm = searchInput.value.toLowerCase();
            console.log(searchTerm);

            const filteredUserArray = userNameData.filter(option => option.toLowerCase().includes(searchTerm));
            // console.log(filteredUserArray);

            populateDropdown(filteredUserArray);
            usersdropdown.classList.toggle('hidden', filteredUserArray.length === 0);
            usersdropdown.style.display = 'block';
        }

        function selectOption(option) {
            document.getElementById('userInput').style.display = 'none';
            document.getElementById('usersdropdown').style.display = 'none';

            const selectedUser = userNameData.find(user => user.userFullName === option);
            if (selectedUser) {
                selectedOwnerUserId = selectedUser.userId;
                console.log('Selected Assigntask UserId:', selectedOwnerUserId);

                matterOwnerUserStatus = selectedUser.userStatus;
                console.log('Selected Assigntask UserStatus:', matterOwnerUserStatus);
            }

            const initials = getInitials(option);
            matterTypeArray.push(option);
            console.log(matterTypeArray);

            const toastContainer = document.getElementById('selectedMatterUser');
            const toast = document.createElement('div');
            toast.className = 'flex justify-between items-center w-3/4 max-w-xs p-4 text-gray-500 bg-white rounded-lg shadow dark:text-gray-400 dark:bg-gray-800 mb-2 matter-type-toast-item';
            toast.dataset.option = option;
            toast.innerHTML = `
            <div class="flex items-center">
                <div class="ms-3 text-sm font-normal flex items-center flex-row">
                    <span style="height: 30px; width: 30px; background: #000000;" class="rounded-full bg-[#000000] text-white flex items-center justify-center">${initials.toUpperCase()}</span> 
                    <div class="flex flex-col">
                        <span style="padding-top: 5px; font-size: 16px;" class="px-2 font-semibold text-black">${option}</span>
                        <span class="px-2">${matterOwnerUserStatus}</span>
                    </div>
                </div>
            </div>
            <button type="button" class="-mx-1.5 -my-1.5 bg-white text-gray-400 hover:text-gray-900 rounded-lg focus:ring-2 focus:ring-gray-300 p-1.5 hover:bg-gray-100 inline-flex items-center justify-center h-8 w-8 dark:text-gray-500 dark:hover:text-white dark:bg-gray-800 dark:hover:bg-gray-700" onclick="removeSelectedMatterUserToast(this)" aria-label="Close">
                <span class="sr-only">Close</span>
                <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                </svg>
            </button>
        `;

            toastContainer.appendChild(toast);
        }

        function getInitials(name) {
            const words = name.split(' ', 2);
            const initials = words.map(word => word.charAt(0)).join('');
            return initials;
        }

        function removeSelectedMatterUserToast(button) {
            const toast = button.parentElement;
            const toastContainer = toast.parentElement;
            const optionToRemove = toast.dataset.option;
            matterTypeArray = matterTypeArray.filter(option => option !== optionToRemove);
            // console.log(matterTypeArray);

            document.getElementById('userInput').style.display = 'block';
            toastContainer.removeChild(toast);
        }

        function showDropdown() {
            const usersdropdown = document.getElementById('usersdropdown');
            usersdropdown.style.display = 'block';
        }

        function hideusersdropdown() {
            const dropdown = document.getElementById('usersdropdown');
            dropdown.style.display = 'none';
        }

        document.addEventListener('click', function (event) {
            const usersinput = document.getElementById('userInput');
            const usersdropdown = document.getElementById('usersdropdown');

            // Check if the click was outside the input and the dropdown
            if (!usersinput.contains(event.target) && !usersdropdown.contains(event.target)) {
                hideusersdropdown();
            }
        });

        // Matter Lead start
        function populateMatterLeadrDropdown(filteredOptions) {
            const TaskreviewerList = document.getElementById('matterleadList');
            TaskreviewerList.innerHTML = '';

            filteredOptions.forEach((option, index) => {
                // console.log(option);
                const li = document.createElement('li');
                li.style.cursor = 'pointer';
                li.style.transition = 'background-color 0.3s';
                li.classList.add('flex', 'items-center', 'text-gray-700', 'hover:bg-gray-100', 'px-4', 'py-2', 'cursor-pointer');

                li.style.padding = '8px';
                li.style.borderBottom = '1px solid #ccc';

                li.addEventListener('mouseenter', () => {
                    li.style.backgroundColor = '#F3FDFF';
                    li.style.color = '#000000';
                });

                li.addEventListener('mouseleave', () => {
                    li.style.backgroundColor = 'transparent';
                    li.style.color = 'black';
                });

                const user = document.createElement('div');

                function getRandomColor() {
                    const letters = '0123456789ABCDEF';
                    let color = '#';
                    for (let i = 0; i < 6; i++) {
                        color += letters[Math.floor(Math.random() * 6)];
                    }
                    return color;
                }

                user.classList.add('w-8', 'h-8', 'rounded-full', 'text-white', 'flex', 'items-center', 'justify-center', 'mr-2');
                user.style.backgroundColor = getRandomColor();
                const initials = option.split(' ', 2).map(word => word.charAt(0)).join('').toUpperCase();
                user.textContent = initials;

                li.appendChild(user);

                const userInfoContainer = document.createElement('div');
                userInfoContainer.classList.add('flex', 'flex-col', 'mx-2');

                const userName = document.createElement('span');
                userName.textContent = option;
                userName.classList.add('pt-2', 'text-base', 'font-semibold');

                const userRole = document.createElement('span');
                // userRole.textContent = combinedData[index].userStatus;
                userRole.textContent = userStatusData;

                userInfoContainer.appendChild(userName);
                userInfoContainer.appendChild(userRole);

                li.appendChild(userInfoContainer);

                li.onclick = () => selectMatterLeadOption(option);
                TaskreviewerList.appendChild(li);
            });
        }

        function showMatterLeadusuers() {
            const searchInput = document.getElementById('matterLeadInput');
            const usersdropdown = document.getElementById('matterleadDropdown');
            const searchTerm = searchInput.value.toLowerCase();

            const filteredUserArray = userNameData.filter(option => option.toLowerCase().includes(searchTerm));
            // console.log(filteredUserArray);

            populateMatterLeadrDropdown(filteredUserArray);
            usersdropdown.classList.toggle('hidden', filteredUserArray.length === 0);
            usersdropdown.style.display = 'block';
        }

        function selectMatterLeadOption(option) {
            document.getElementById('matterLeadInput').style.display = 'none';
            document.getElementById('matterleadDropdown').style.display = 'none';

            const selectedMatterTypesContainer = document.getElementById('SelectedMatterLeaduser');
            const existingMatterTypeItems = selectedMatterTypesContainer.querySelectorAll('.matter-type-toast-item');

            const selectedUser = userNameData.find(user => user.userFullName === option);
            if (selectedUser) {
                selectedLeadUserId = selectedUser.userId;
                console.log('Selected Assigntask UserId:', selectedLeadUserId);

                matterLeadUserStatus = selectedUser.userStatus;
                console.log('Selected Assigntask UserStatus:', matterLeadUserStatus);
            }

            const initials = getInitials(option);
            matterTypeArray.push(option);
            console.log(matterTypeArray);
            const toastContainer = document.getElementById('SelectedMatterLeaduser');
            const toast = document.createElement('div');
            toast.className = 'flex justify-between items-center w-3/4 max-w-xs p-4 text-gray-500 bg-white rounded-lg shadow dark:text-gray-400 dark:bg-gray-800 mb-2 matter-type-toast-item';
            toast.dataset.option = option;
            toast.innerHTML = `
            <div class="flex items-center">
                <div class="ms-3 text-sm font-normal flex items-center flex-row">
                    <span style="height: 30px; width: 30px; background: #000000;" class="rounded-full bg-[#000000] text-white flex items-center justify-center">${initials.toUpperCase()}</span> 
                    <div class="flex flex-col">
                        <span style="padding-top: 5px; font-size: 16px;" class="px-2 font-semibold text-black">${option}</span>
                        <span class="px-2">${matterLeadUserStatus}</span>
                    </div>
                </div>
            </div>
            <button type="button" class="-mx-1.5 -my-1.5 bg-white text-gray-400 hover:text-gray-900 rounded-lg focus:ring-2 focus:ring-gray-300 p-1.5 hover:bg-gray-100 inline-flex items-center justify-center h-8 w-8 dark:text-gray-500 dark:hover:text-white dark:bg-gray-800 dark:hover:bg-gray-700" onclick="removeSelectedLeadUserToast(this)" aria-label="Close">
                <span class="sr-only">Close</span>
                <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                </svg>
            </button>
        `;

            toastContainer.appendChild(toast);
        }

        function getInitials(name) {
            const words = name.split(' ', 2);
            const initials = words.map(word => word.charAt(0)).join('');
            return initials;
        }

        function removeSelectedLeadUserToast(button) {
            const toast = button.parentElement;
            const toastContainer = toast.parentElement;
            const optionToRemove = toast.dataset.option;
            matterTypeArray = matterTypeArray.filter(option => option !== optionToRemove);
            // console.log(matterTypeArray);

            document.getElementById('matterLeadInput').style.display = 'block';
            toastContainer.removeChild(toast);
        }

        function showDropdown() {
            const usersdropdown = document.getElementById('matterleadDropdown');
            usersdropdown.style.display = 'block';
        }

        function hideReviewerdropdown() {
            const dropdown = document.getElementById('matterleadDropdown');
            dropdown.style.display = 'none';
        }

        document.addEventListener('click', function (event) {
            const usersinput = document.getElementById('matterLeadInput');
            const usersdropdown = document.getElementById('matterleadDropdown');

            // Check if the click was outside the input and the dropdown
            if (!usersinput.contains(event.target) && !usersdropdown.contains(event.target)) {
                hideReviewerdropdown();
            }
        });

        // for matter type
        const matterTypeOptionsArray = ['Legal', 'Financial', 'Contract', 'Intellectual Property', 'Other'];
        function showMatterTypeDropdown() {
            const searchTerm = document.getElementById('matterType').value.toLowerCase();
            const filteredOptions = matterTypeOptionsArray.filter(option => option.toLowerCase().includes(searchTerm));

            const matterdropdown = document.getElementById('matterTypeDropdown');
            const matterTypeOptionsList = document.getElementById('matterTypeOptionsList');

            matterTypeOptionsList.innerHTML = '';

            filteredOptions.forEach(option => {
                const li = document.createElement('li');
                li.style.cursor = 'pointer';
                li.style.transition = 'background-color 0.3s';

                li.style.padding = '8px';
                li.style.borderBottom = '1px solid #ccc';

                li.addEventListener('mouseenter', () => {
                    li.style.backgroundColor = '#6366f1';
                    li.style.color = 'white';
                });

                li.addEventListener('mouseleave', () => {
                    li.style.backgroundColor = 'transparent';
                    li.style.color = 'black';
                });

                li.addEventListener('click', () => selectMatterType(option));
                matterTypeOptionsList.appendChild(li);
                li.textContent = option;
                li.addEventListener('click', () => selectMatterType(option));
                matterTypeOptionsList.appendChild(li);
            });

            matterdropdown.style.display = 'block';
        }


        function selectMatterType(option) {
            document.getElementById('matterType').value = '';
            document.getElementById('matterTypeDropdown').style.display = 'none';

            const selectedMatterTypesContainer = document.getElementById('selectedMatterTypes');
            const existingMatterTypeItems = selectedMatterTypesContainer.querySelectorAll('.matter-type-toast-item');

            for (const existingItem of existingMatterTypeItems) {
                if (existingItem.dataset.option === option) {
                    return;
                }
            }
            matterTypeArray.push(option);
            console.log(matterTypeArray);
            const toastContainer = document.getElementById('selectedMatterTypes');
            const toast = document.createElement('div');
            toast.className = 'flex justify-between items-center w-3/4 max-w-xs p-4 text-gray-500 bg-white rounded-lg shadow dark:text-gray-400 dark:bg-gray-800 mb-2 matter-type-toast-item';
            toast.dataset.option = option;
            toast.innerHTML = `
            <div class="flex items-center">
                <div class="ms-3 text-sm font-normal">${option}</div>
            </div>
            <button type="button" class="-mx-1.5 -my-1.5 bg-white text-gray-400 hover:text-gray-900 rounded-lg focus:ring-2 focus:ring-gray-300 p-1.5 hover:bg-gray-100 inline-flex items-center justify-center h-8 w-8 dark:text-gray-500 dark:hover:text-white dark:bg-gray-800 dark:hover:bg-gray-700" onclick="removeMatterTypeToast(this)" aria-label="Close">
                <span class="sr-only">Close</span>
                <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                </svg>
            </button>
        `;

            toastContainer.appendChild(toast);
        }

        function removeMatterTypeToast(button) {
            const toast = button.parentElement;
            const toastContainer = toast.parentElement;
            const optionToRemove = toast.dataset.option;
            matterTypeArray = matterTypeArray.filter(option => option !== optionToRemove);
            // console.log(matterTypeArray)

            toastContainer.removeChild(toast);
        }

        function hideMatterTypeDropdown() {
            const dropdown = document.getElementById('matterTypeDropdown');
            dropdown.style.display = 'none';
        }

        document.addEventListener('click', function (event) {
            const matterTypeInput = document.getElementById('matterType');
            const matterTypeDropdown = document.getElementById('matterTypeDropdown');

            // Check if the click was outside the input and the dropdown
            if (!matterTypeInput.contains(event.target) && !matterTypeDropdown.contains(event.target)) {
                hideMatterTypeDropdown();
            }
        });

        // For Jurisdiction
        const optionsArray = ['USA', 'USA', 'District of Columbia'];
        function showDropdown() {
            const searchTerm = document.getElementById('Jurisdiction').value.toLowerCase();
            const filteredOptions = optionsArray.filter(option => option.toLowerCase().includes(searchTerm));

            const dropdown = document.getElementById('Jurisdictiondropdown');
            const JurisdictionoptionsList = document.getElementById('JurisdictionoptionsList');

            JurisdictionoptionsList.innerHTML = '';

            filteredOptions.forEach(option => {
                const li = document.createElement('li');
                li.style.cursor = 'pointer';
                li.style.transition = 'background-color 0.3s';

                // Add styles for regular state
                li.style.padding = '8px';
                li.style.borderBottom = '1px solid #ccc';

                li.addEventListener('mouseenter', () => {
                    li.style.backgroundColor = '#6366f1';
                    li.style.color = 'white';
                });

                li.addEventListener('mouseleave', () => {
                    li.style.backgroundColor = 'transparent';
                    li.style.color = 'black';

                });

                li.textContent = option;
                li.addEventListener('click', () => selectJurisdiction(option));
                JurisdictionoptionsList.appendChild(li);
            });

            dropdown.style.display = 'block';
        }

        function selectJurisdiction(option) {
            document.getElementById('Jurisdiction').value = '';
            document.getElementById('Jurisdictiondropdown').style.display = 'none';

            const selectedItemsContainer = document.getElementById('selectedItems');
            const existingItems = selectedItemsContainer.querySelectorAll('.toast-item');
            console.log(existingItems)
            for (const existingItem of existingItems) {
                if (existingItem.dataset.option === option) {
                    return;
                }
            }
            jurisdictionArray.push(option);
            console.log(jurisdictionArray);

            const toastContainer = document.getElementById('selectedItems');
            const toast = document.createElement('div');
            toast.className = 'flex justify-between items-center w-3/4 max-w-xs p-4 text-gray-500 bg-white rounded-lg shadow dark:text-gray-400 dark:bg-gray-800 mb-2 toast-item';
            toast.dataset.option = option;
            toast.innerHTML = `
            <div class="flex items-center">
                <div class="ms-3 text-sm font-normal">${option}</div>
            </div>
            <button type="button" class="-mx-1.5 -my-1.5 bg-white text-gray-400 hover:text-gray-900 rounded-lg focus:ring-2 focus:ring-gray-300 p-1.5 hover:bg-gray-100 inline-flex items-center justify-center h-8 w-8 dark:text-gray-500 dark:hover:text-white dark:bg-gray-800 dark:hover:bg-gray-700" onclick="removeJurisdictionToast(this)" aria-label="Close">
                <span class="sr-only">Close</span>
                <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                </svg>
            </button>
        `;

            toastContainer.appendChild(toast);
        }

        function removeJurisdictionToast(button) {
            const toast = button.parentElement;
            const toastContainer = toast.parentElement;
            const optionToRemove = toast.dataset.option;
            jurisdictionArray = jurisdictionArray.filter(option => option !== optionToRemove);
            // console.log(jurisdictionArray);

            toastContainer.removeChild(toast);
        }

        function hideJurisdictionDropdown() {
            const dropdown = document.getElementById('Jurisdictiondropdown');
            dropdown.style.display = 'none';
        }

        document.addEventListener('click', function (event) {
            const JurisdictionInput = document.getElementById('Jurisdiction');
            const JurisdictionDropdown = document.getElementById('Jurisdictiondropdown');

            // Check if the click was outside the input and the dropdown
            if (!JurisdictionInput.contains(event.target) && !JurisdictionDropdown.contains(event.target)) {
                hideJurisdictionDropdown();
            }
        });
    </script>
</body>

</html>